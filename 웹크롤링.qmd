---
title: "Untitled"
format: html
---

# 패키지 불러오기
```{python}
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
#  selenium의 webdriver를 사용하기 위한 import
from selenium import webdriver
# selenium으로 무엇인가 입력하기 위한 import
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
# 페이지 로딩을 기다리는데에 사용할 time 모듈 imports
from selenium.webdriver.chrome.options import Options
import pandas as pd
from pyshadow.main import Shadow
```


# user- agent로 크롬창 열기 
```{python}
options = Options()

options.add_argument(
    "user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) "
    "AppleWebKit/537.36 (KHTML, like Gecko) "
    "Chrome/120.0.0.0 Safari/537.36"
)

# 크롬드라이버 실행
# service= Service(ChromeDriverManager().install()),
driver = webdriver.Chrome(options=options) 
```



# 리뷰 홈페이지 불러오기

mobile로 바꾸기
```{python}
url = "https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=A000000198001&dispCatNo=1000001000700080011&trackingCd=Cat1000001000700080011_Small&t_page=%EC%B9%B4%ED%85%8C%EA%B3%A0%EB%A6%AC%EA%B4%80&t_click=%EC%BF%A0%EC%85%98/%ED%8C%8C%EC%9A%B4%EB%8D%B0%EC%9D%B4%EC%85%98_%EC%A0%84%EC%B2%B4_%EA%B7%B8%EB%9D%BC%ED%8E%9C,%EB%8B%A4%EC%8A%88,%EB%91%90%EC%9E%89%EC%99%93,%EB%B9%84%EB%A0%88%EB%94%94,%EC%98%A4%EB%B8%8C%EC%A0%9C_%EC%83%81%ED%92%88%EC%83%81%EC%84%B8&t_number=1&tab=review"
#크롬 드라이버에 url 주소 넣고 실행
driver.get(url)

# 페이지가 완전히 로딩되도록 3초동안 기다림
time.sleep(3)
```

# shadow dom을 뚫기 위해서 driver 수정
```{python}
shadow = Shadow(driver)
```


```{python}
df = pd.read_csv('화장품정보.csv')
df
```

```{python}
df = pd.read_pickle('화장품정보all.plk')
```

```{python}
url_list = df['링크'] + "&tab=review"
```

```{python}
url_list[0]
```


```{python}
shadow.find_element('oy-review-star-rating > div > div.star-container >  div.stars > div.rating-score').text
```

```{python}
shadow.find_element('oy-review-star-rating > div > div.total-count').text
```


```{python}
rating_data = []
for i in range(len(url_list)):
    url = url_list[i]
    driver.get(url)
    shadow = Shadow(driver)
    time.sleep(3)

    try:
        rating_score = shadow.find_element('oy-review-star-rating > div > div.star-container >  div.stars > div.rating-score').text
        total_count = shadow.find_element('oy-review-star-rating > div > div.total-count').text

        name_element = shadow.find_elements("h3[class*='GoodsDetailInfo_title']")
        name_text = name_element[0].text if name_element else "이름 없음"

        rating_data.append({'이름' : name_text, '평균리뷰점수' : rating_score, '리뷰수': total_count})

        print(f"{i+1}번째 상품 완료: {name_text}")

    except Exception as e:
        print(f"{i+1}번째 상품에서 오류 발생: {e}")
        continue # 에러 난 상품은 건너뛰고 다음 상품 진행

```


```{python}
rate_df = pd.DataFrame(rating_data)
rate_df
```


```{python}
rate_df.to_csv('리뷰수all.csv')
```



```{python}
df
```


```{python}
pd.merge(left=df, right = rate_df, how='inner',on='이름').to_pickle('화장품최종본.plk')
```


```{python}
import pandas as pd
df = pd.read_pickle('화장품최종본.plk')
```


```{python}
df['리뷰수'].str.replace(',', repl= "").str.extract('([0-9]+)').astype('int').sum()
```

20531




```{python}
화장품정보 = pd.read_pickle('화장품정보all.plk')
```


```{python}
리뷰수 = pd.read_csv('리뷰수all.csv')
```


```{python}
pd.merge(left=화장품정보, right = 리뷰수, how='inner',on='이름').to_pickle('화장품최종본all.plk')
```


```{python}
화장품최종본all = pd.read_pickle('화장품최종본all.plk')
```

```{python}
화장품최종본all['리뷰수'].str.replace(',', repl= "").str.extract('([0-9]+)').astype('int').sum()
```